<?php

namespace Database\Seeders;

use App\Models\Course;
use App\Models\Module;
use App\Models\User;
use App\Models\CourseEnrollment;
use Illuminate\Database\Seeder;

class CourseSeeder extends Seeder
{
    /**
     * Run the database seeds.
     */
    public function run(): void
    {
        $this->command->info('üöÄ Criando cursos de exemplo...');

        // 1. Curso de Onboarding (Obrigat√≥rio)
        $onboardingCourse = Course::create([
            'title' => 'Onboarding da Empresa HCP',
            'description' => 'Bem-vindo √† HCP! Este curso apresenta nossa hist√≥ria, cultura, valores, pol√≠ticas essenciais e ferramentas que voc√™ utilizar√° no dia a dia. √â o primeiro passo para se integrar completamente √† nossa equipe e compreender como contribuir para o sucesso da empresa.',
            'short_description' => 'Curso introdut√≥rio essencial para novos colaboradores da HCP',
            'duration_hours' => 8,
            'difficulty_level' => 'beginner',
            'type' => 'mandatory',
            'is_active' => true,
            'order_index' => 1,
            'tags' => ['onboarding', 'cultura', 'pol√≠ticas', 'introdu√ß√£o', 'obrigat√≥rio']
        ]);

        // 2. Curso de Seguran√ßa da Informa√ß√£o (Obrigat√≥rio)
        $securityCourse = Course::create([
            'title' => 'Seguran√ßa da Informa√ß√£o',
            'description' => 'Aprenda sobre as melhores pr√°ticas de seguran√ßa da informa√ß√£o, prote√ß√£o de dados, pol√≠ticas de senha, phishing, e como manter a seguran√ßa digital da empresa. Este curso √© essencial para todos os colaboradores.',
            'short_description' => 'Fundamentos de seguran√ßa digital e prote√ß√£o de dados',
            'duration_hours' => 4,
            'difficulty_level' => 'beginner',
            'type' => 'mandatory',
            'is_active' => true,
            'order_index' => 2,
            'tags' => ['seguran√ßa', 'informa√ß√£o', 'dados', 'prote√ß√£o', 'obrigat√≥rio']
        ]);

        // 3. Curso de Gest√£o de Projetos (Opcional)
        $projectManagementCourse = Course::create([
            'title' => 'Gest√£o de Projetos √Ågeis',
            'description' => 'Domine as metodologias √°geis de gest√£o de projetos, incluindo Scrum, Kanban e ferramentas de produtividade. Ideal para l√≠deres de equipe e profissionais que desejam aprimorar suas habilidades de gest√£o.',
            'short_description' => 'Metodologias √°geis e ferramentas de gest√£o de projetos',
            'duration_hours' => 12,
            'difficulty_level' => 'intermediate',
            'type' => 'optional',
            'is_active' => true,
            'order_index' => 3,
            'tags' => ['gest√£o', 'projetos', 'scrum', 'kanban', 'lideran√ßa']
        ]);

        $this->command->info('‚úÖ Cursos criados com sucesso!');
        $this->command->info('üìö Criando m√≥dulos para os cursos...');

        // M√≥dulos para o Curso de Onboarding
        $onboardingModules = [
            [
                'title' => 'Hist√≥ria da HCP',
                'description' => 'Conhe√ßa a trajet√≥ria da HCP, desde sua funda√ß√£o at√© os dias atuais, principais marcos e conquistas.',
                'duration_minutes' => 45,
                'content_type' => 'video',
                'order_index' => 1,
                'category' => 'culture'
            ],
            [
                'title' => 'Cultura e Valores',
                'description' => 'Entenda nossa cultura organizacional, valores fundamentais e como eles guiam nossas decis√µes di√°rias.',
                'duration_minutes' => 60,
                'content_type' => 'interactive',
                'order_index' => 2,
                'category' => 'culture'
            ],
            [
                'title' => 'Estrutura Organizacional',
                'description' => 'Conhe√ßa a estrutura da empresa, departamentos, hierarquia e principais contatos.',
                'duration_minutes' => 30,
                'content_type' => 'text',
                'order_index' => 3,
                'category' => 'hr'
            ],
            [
                'title' => 'Pol√≠ticas e Procedimentos',
                'description' => 'Pol√≠ticas de RH, c√≥digo de conduta, procedimentos internos e regulamenta√ß√µes importantes.',
                'duration_minutes' => 90,
                'content_type' => 'document',
                'order_index' => 4,
                'category' => 'compliance'
            ],
            [
                'title' => 'Ferramentas e Sistemas',
                'description' => 'Apresenta√ß√£o das principais ferramentas e sistemas utilizados no dia a dia de trabalho.',
                'duration_minutes' => 75,
                'content_type' => 'video',
                'order_index' => 5,
                'category' => 'it'
            ]
        ];

        foreach ($onboardingModules as $moduleData) {
            Module::create(array_merge($moduleData, [
                'course_id' => $onboardingCourse->id,
                'is_active' => true,
                'estimated_duration' => $moduleData['duration_minutes']
            ]));
        }

        // M√≥dulos para o Curso de Seguran√ßa da Informa√ß√£o
        $securityModules = [
            [
                'title' => 'Fundamentos de Seguran√ßa',
                'description' => 'Conceitos b√°sicos de seguran√ßa da informa√ß√£o e principais amea√ßas digitais.',
                'duration_minutes' => 45,
                'content_type' => 'video',
                'order_index' => 1,
                'category' => 'security'
            ],
            [
                'title' => 'Pol√≠ticas de Senha',
                'description' => 'Como criar senhas seguras, uso de gerenciadores de senha e autentica√ß√£o de dois fatores.',
                'duration_minutes' => 30,
                'content_type' => 'interactive',
                'order_index' => 2,
                'category' => 'security'
            ],
            [
                'title' => 'Phishing e Engenharia Social',
                'description' => 'Identifica√ß√£o e preven√ß√£o de ataques de phishing e t√©cnicas de engenharia social.',
                'duration_minutes' => 40,
                'content_type' => 'video',
                'order_index' => 3,
                'category' => 'security'
            ],
            [
                'title' => 'Prote√ß√£o de Dados',
                'description' => 'LGPD, prote√ß√£o de dados pessoais e boas pr√°ticas de manuseio de informa√ß√µes.',
                'duration_minutes' => 50,
                'content_type' => 'document',
                'order_index' => 4,
                'category' => 'compliance'
            ]
        ];

        foreach ($securityModules as $moduleData) {
            Module::create(array_merge($moduleData, [
                'course_id' => $securityCourse->id,
                'is_active' => true,
                'estimated_duration' => $moduleData['duration_minutes']
            ]));
        }

        // M√≥dulos para o Curso de Gest√£o de Projetos
        $projectModules = [
            [
                'title' => 'Introdu√ß√£o √†s Metodologias √Ågeis',
                'description' => 'Hist√≥ria e princ√≠pios das metodologias √°geis, diferen√ßas com m√©todos tradicionais.',
                'duration_minutes' => 60,
                'content_type' => 'video',
                'order_index' => 1,
                'category' => 'processes'
            ],
            [
                'title' => 'Framework Scrum',
                'description' => 'Pap√©is, eventos e artefatos do Scrum. Como implementar Scrum em sua equipe.',
                'duration_minutes' => 90,
                'content_type' => 'interactive',
                'order_index' => 2,
                'category' => 'processes'
            ],
            [
                'title' => 'M√©todo Kanban',
                'description' => 'Princ√≠pios do Kanban, visualiza√ß√£o do fluxo de trabalho e melhoria cont√≠nua.',
                'duration_minutes' => 75,
                'content_type' => 'video',
                'order_index' => 3,
                'category' => 'processes'
            ],
            [
                'title' => 'Ferramentas de Gest√£o',
                'description' => 'Jira, Trello, Azure DevOps e outras ferramentas para gest√£o √°gil de projetos.',
                'duration_minutes' => 80,
                'content_type' => 'interactive',
                'order_index' => 4,
                'category' => 'it'
            ]
        ];

        foreach ($projectModules as $moduleData) {
            Module::create(array_merge($moduleData, [
                'course_id' => $projectManagementCourse->id,
                'is_active' => true,
                'estimated_duration' => $moduleData['duration_minutes']
            ]));
        }

        $this->command->info('‚úÖ M√≥dulos criados com sucesso!');
        $this->command->info('üë• Criando inscri√ß√µes de exemplo...');

        // Criar algumas inscri√ß√µes de exemplo
        $users = User::where('role', '!=', 'admin')->take(10)->get();
        
        foreach ($users as $user) {
            // Inscrever todos os usu√°rios nos cursos obrigat√≥rios
            CourseEnrollment::create([
                'user_id' => $user->id,
                'course_id' => $onboardingCourse->id,
                'enrolled_at' => now()->subDays(rand(1, 30)),
                'status' => ['enrolled', 'in_progress', 'completed'][rand(0, 2)],
                'progress_percentage' => rand(0, 100)
            ]);

            CourseEnrollment::create([
                'user_id' => $user->id,
                'course_id' => $securityCourse->id,
                'enrolled_at' => now()->subDays(rand(1, 20)),
                'status' => ['enrolled', 'in_progress', 'completed'][rand(0, 2)],
                'progress_percentage' => rand(0, 100)
            ]);

            // Alguns usu√°rios se inscrevem em cursos opcionais
            if (rand(0, 1)) {
                CourseEnrollment::create([
                    'user_id' => $user->id,
                    'course_id' => $projectManagementCourse->id,
                    'enrolled_at' => now()->subDays(rand(1, 15)),
                    'status' => ['enrolled', 'in_progress'][rand(0, 1)],
                    'progress_percentage' => rand(0, 80)
                ]);
            }
        }

        $this->command->info('‚úÖ Inscri√ß√µes criadas com sucesso!');
        $this->command->info('');
        $this->command->info('üéâ Sistema de Cursos configurado com sucesso!');
        $this->command->info('');
        $this->command->info('üìã Resumo:');
        $this->command->info("   ‚Ä¢ {$onboardingCourse->modules()->count()} m√≥dulos no curso de Onboarding");
        $this->command->info("   ‚Ä¢ {$securityCourse->modules()->count()} m√≥dulos no curso de Seguran√ßa");
        $this->command->info("   ‚Ä¢ {$projectManagementCourse->modules()->count()} m√≥dulos no curso de Gest√£o de Projetos");
        $this->command->info("   ‚Ä¢ " . CourseEnrollment::count() . " inscri√ß√µes de exemplo criadas");
        $this->command->info('');
        $this->command->info('üöÄ Acesse /courses para ver os cursos dispon√≠veis!');
    }
}